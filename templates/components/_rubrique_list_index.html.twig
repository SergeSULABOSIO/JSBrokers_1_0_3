<div 
    data-controller = "rubrique" 
    data-rubrique-nom-value={{rubrique_nom}}
    class="d-flex flex-column h-100"
>
    <div 
        id = "liste" 
        class="flex-grow-1 d-flex flex-column" 
        data-controller="dialogue liste-principale" 
        data-liste-principale-identreprise-value={{entreprise.id}} 
        data-liste-principale-idutilisateur-value={{utilisateur.id}} 
        data-liste-principale-nbelements-value={{data|length}} 
        data-liste-principale-rubrique-value={{rubrique_nom}} 
        data-liste-principale-entite-value={{entite_nom}} 
        data-liste-principale-controleurphp-value={{racine_url_controleur_php_nom}} 
        data-liste-principale-controleurstimulus-value={{controleur_stimulus_nom}} 
        data-liste-principale-entity-form-canvas-value='{{ entityFormCanvas|json_encode|e('html_attr') }}' 
    >
        {# Ce conteneur va aussi utiliser flexbox et cacher tout débordement #}
        <div class="shadow-sm sensible bg-white d-flex flex-column flex-grow-1" style="overflow: hidden;">
            {# Les barres d'outils ne grandissent pas #}
            <div class="flex-shrink-0">
                {# Barre d'outils #} 
                {{ include("components/_liste_barre_outils.html.twig") }}
                {# Barre de Recherche #}
                {{ component('_search_bar') }}
                {# Barre des totaux #}
                {{ include('components/_totals_bar.html.twig') }}
            </div>

            {# NOUVEAU : Un wrapper pour le tableau qui gère le défilement #}
            <div class="table-scroll-wrapper flex-grow-1">
                {# Tableau #}
                <table class="table table-hover table-sm caption-top p-3 table-enhanced">
                    <caption>
                        <span data-liste-principale-target = "display">
                            {% if data|length == 0 %}
                                {{ "list_filter_result_empty" | trans}}
                            {% else %}
                                {{ "list_filter_result_elements" | trans({
                                    ':number': data|length
                                })}}
                            {% endif %}
                        </span>
                        <div class="d-flex gap-1">
                            {{ knp_pagination_render(data) }}
                        </div>
                    </caption>
                    {% if data|length != 0 %}
                        {# MODIFICATION : On ajoute une classe pour rendre l'en-tête collant #}
                        <thead class="table-light sticky-header">
                            <tr class="text-center">
                                {# ============================================================ #}
                                {# DÉBUT MODIFICATION : EN-TÊTES DE COLONNES DYNAMIQUES        #}
                                {# ============================================================ #}

                                {# Colonne 1 : Statique pour la case à cocher et l'ID #}
                                <th scope="col" style="width: 80px;">
                                    <div class="form-check m-2 justify-content-start">
                                        <input 
                                            class="form-check-input" 
                                            value="" 
                                            type="checkbox" 
                                            id="myCheckbox" 
                                            data-action="change->liste-principale#handleItemToutCocher" 
                                            data-liste-principale-target="selectAllCheckbox"
                                        >
                                        <label 
                                            for="myCheckbox"
                                            class="text-secondary" 
                                        >
                                            Id.  
                                        </label>
                                    </div>
                                </th>
                                
                                {# Colonne 2 : Titre de la colonne principale depuis ListeCanvas #}
                                {% if listeCanvas.colonne_principale is defined %}
                                    <th scope="col">
                                        <div class='d-flex justify-content-start text-secondary m-2'>
                                            {{ listeCanvas.colonne_principale.titre_colonne | default('Titre principal') }}
                                        </div>
                                    </th>
                                {% endif %}

                                {# Colonnes suivantes : Titres des colonnes numériques depuis ListeCanvas #}
                                {% if listeCanvas.colonnes_numeriques is defined %}
                                    {% for colonne in listeCanvas.colonnes_numeriques %}
                                        <th scope="col" style="width:150px"> {# Largeur fixe pour l'alignement #}
                                            <div class='d-flex justify-content-end text-secondary m-2'>
                                                {{ colonne.titre_colonne | default('Valeur') }}
                                            </div>
                                        </th>
                                    {% endfor %}
                                {% endif %}

                                {# ============================================================ #}
                                {# FIN MODIFICATION : EN-TÊTES DE COLONNES DYNAMIQUES           #}
                                {# ============================================================ #}
                            </tr>
                        </thead>

                        {# CONTENU DU TABLEAU #}
                        <tbody class="table-group-divider context-target" data-liste-principale-target = "donnees">
                            {{ include('components/_list_donnees.html.twig') }}
                        </tbody>
                    {% endif %}
                </table>
            </div>
        </div>
        {{ include('components/_menu_contextuel.html.twig') }}
        {{ include('components/_dialogue.html.twig') }}
    </div>
</div>