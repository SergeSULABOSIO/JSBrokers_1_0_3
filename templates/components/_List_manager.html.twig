{#
    Ce template est un composant générique et réutilisable pour afficher une liste d'entités sous forme de tableau.
    Il est le conteneur principal qui orchestre l'affichage des en-têtes, des données et de l'état vide.

    Contrôleur Stimulus associé :
    - `list-manager` (anciennement `liste-principale`): Gère l'ensemble de la liste, y compris la sélection, le tri,
      la pagination (via des événements) et les actions globales comme "tout cocher" ou "ajouter".

    Paramètres attendus :
    - `data`: La collection d'entités à afficher.
    - `entite_nom`: Le nom de l'entité (ex: "Client", "Piste").
    - `entityFormCanvas`: La configuration du formulaire de l'entité, utilisée pour les actions d'ajout/édition.
    - `listeCanvas`: La configuration d'affichage de la liste (colonnes, titres).
    - `numericAttributes` (optionnel): Attributs numériques pour les totaux.
#}
<div 
        id="{{ listId | default('list-controller-' ~ random()) }}" {# CORRECTION : Utiliser un ID prédictible ou un fallback aléatoire. #}
        data-controller="list-manager" 
        data-list-manager-nbelements-value="{{ data|length }}" 
        data-list-manager-entite-value="{{ entite_nom }}" 
        data-list-manager-server-root-name-value="{{ serverRootName }}" 
        data-list-manager-id-entreprise-value="{{ idEntreprise }}" 
        data-list-manager-id-invite-value="{{ idInvite }}"  
        data-list-manager-entity-form-canvas-value='{{ entityFormCanvas|json_encode|e('html_attr') }}' 
        data-list-manager-numeric-attributes-and-values-value='{{ numericAttributesAndValues|default({})|json_encode|e('html_attr') }}'
        data-list-manager-list-url-value="{{ listUrl | default('') }}" {# CORRECTION : Ajout de l'URL unique pour la persistance #}
    > 
        <div class="table-scroll-wrapper flex-grow-1" data-list-manager-target="listContainer">
            <table class="table table-hover table-sm table-enhanced">
                <thead class="table-light sticky-header">
                    <tr class="text-center">
                        <th scope="col" style="width: 80px;">
                            <div class="form-check m-2 justify-content-start">
                                <input class="form-check-input" type="checkbox" data-action="change->list-manager#toggleAll" data-list-manager-target="selectAllCheckbox">
                                <label class="text-secondary">Id.</label>
                            </div>
                        </th>
                        {% if listeCanvas.colonne_principale is defined %}
                            <th scope="col">
                                <div class='d-flex justify-content-start text-secondary m-2'>{{ listeCanvas.colonne_principale.titre_colonne | default('Titre principal') }}</div>
                            </th>
                        {% endif %}
                        {% for colonne in listeCanvas.colonnes_numeriques | default([]) %}
                            <th scope="col" style="width:150px">
                                <div class='d-flex justify-content-end text-secondary m-2'>{{ colonne.titre_colonne | default('Valeur') }}</div>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="table-group-divider context-target" data-list-manager-target="donnees">
                    {# Le contenu sera injecté ici par le contrôleur #}
                </tbody>
            </table>
        </div>
        <div data-list-manager-target="emptyStateContainer" class="d-none h-100">
            {{ include('components/_empty_state.html.twig', {
                title: "Aucun " ~ entite_nom|lower ~ " ne correspond à votre recherche",
                description: "Essayez de modifier ou de réinitialiser vos critères de recherche.",
                button_text: "Réinitialiser la recherche",
                button_action: "click->list-manager#resetSearch",
                icon_name: entityCanvas.parametres.icone | default('lucide:search-x')
            }) }}
        </div>
    </div>
</div>
