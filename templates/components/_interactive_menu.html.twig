{#
    Ce template est le composant principal de l'interface utilisateur, représentant le menu interactif global.
    Il est piloté par le contrôleur Stimulus `workspace-manager` (anciennement `espace-de-travail`).

    Sa structure est divisée en quatre colonnes :
    1. `menu-col-1`: La barre de navigation principale avec les icônes des grands modules (Finances, Marketing, etc.).
    2. `menu-col-2`: Une zone de contexte qui affiche soit la description d'un module, soit la liste des "rubriques" (sous-menus) du module sélectionné.
    3. `menu-col-3`: L'espace de travail principal (`workspace`) où les composants de liste (ex: la liste des clients) sont chargés.
    4. `menu-col-4`: La colonne de visualisation (`visualizationColumn`) qui apparaît lorsqu'un élément d'une liste est ouvert. Elle contient un système d'onglets pour afficher les détails de plusieurs éléments.

    Le contrôleur `workspace-manager` gère :
    - La navigation et la mise en évidence des éléments actifs.
    - Le chargement dynamique des composants dans l'espace de travail via des appels au "Cerveau".
    - La création, l'activation et la fermeture des onglets dans la colonne de visualisation.
    - La persistance de l'état (se souvenir de la dernière rubrique ouverte).
#}
{% set menu = menu_data %}
<div 
    {{ stimulus_controller('workspace-manager') }} 
    data-workspace-manager-id-entreprise-value="{{ idEntreprise }}"
    data-workspace-manager-id-invite-value="{{ idInvite }}"
>
    {# Barre de progression globale, contrôlée par Stimulus #}
    <div data-workspace-manager-target="progressBar" class="progress-bar"></div>
    <div class="interactive-menu">
        {# COLONNE 1 : Navigation principale #}
        <div class="menu-col-1">
            {# Ligne 1: Tableau de bord #}
            <div class="menu-col-1-row-1">
                <div class="nav-item"
                    data-action="click->workspace-manager#loadComponent"
                    data-workspace-manager-component-name-param="{{ menu.colonne_1.tableau_de_bord.composant_twig }}"
                    data-workspace-manager-description-param="{{ menu.colonne_1.tableau_de_bord.description }}"
                    data-workspace-manager-target="dashboardItem"  {# AJOUTEZ CETTE LIGNE #}
                >
                    <twig:UX:Icon name="{{ resolve_icon_name(menu.colonne_1.tableau_de_bord.icone) }}" class="nav-icon" />
                    <span class="nav-text">{{ menu.colonne_1.tableau_de_bord.nom }}</span>
                </div>
            </div>

            {# Ligne 2: Groupes #}
            <div class="menu-col-1-row-2">
                {% for group_name, group_data in menu.colonne_1.groupes %}
                    <div class="nav-item"
                        data-action="mouseenter->workspace-manager#showGroupDescription mouseleave->workspace-manager#clearDescription click->workspace-manager#showGroupRubriques"
                        data-workspace-manager-group-name-param="{{ group_name }}"
                        data-workspace-manager-description-param="{{ group_data.description }}"
                    >
                        <twig:UX:Icon name="{{ resolve_icon_name(group_data.icone) }}" class="nav-icon" />
                        <span class="nav-text">{{ group_name }}</span>
                    </div>
                {% endfor %}
            </div>

            {# Ligne 3: Paramètres #}
            <div class="menu-col-1-row-3">
                {% for param_name, param_data in menu.colonne_1.parametres %}
                    <div class="nav-item"
                        data-action="click->workspace-manager#loadComponent"
                        data-workspace-manager-component-name-param="{{ param_data.composant_twig }}"
                        data-workspace-manager-description-param="{{ param_data.description }}"
                    >
                        <twig:UX:Icon name="{{ resolve_icon_name(param_data.icone) }}" class="nav-icon" />
                        <span class="nav-text">{{ param_name }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>

        {# COLONNE 2 : Rubriques & Descriptions #}
        <div class="menu-col-2">
            {# Ligne 1: Infos Entreprise #}
            <div class="menu-col-2-row-1">
                <img src="{{ asset(menu.colonne_2.logo) }}" alt="Logo" class="company-logo">
                <h2 class="company-title">{{ menu.colonne_2.titre }}</h2>
                <p class="company-description">{{ menu.colonne_2.description }}</p>
                <span class="company-version">Version {{ menu.colonne_2.version }}</span>
            </div>
            {# Ligne 2: Zone dynamique pour descriptions et rubriques #}
            <div class="menu-col-2-row-2" data-workspace-manager-target="contentZone">
                {# Contenu injecté par Stimulus #}
            </div>
        </div>

        {# COLONNE 3 : Espace de travail #}
        <div class="menu-col-3" data-workspace-manager-target="workspace">
            {# NOUVEAU : On affiche directement le squelette au chargement initial. #}
            {# Il sera remplacé par le composant chargé ou restauré. #}
            <div class="workspace-skeleton">
                <div class="skeleton-header">
                    <div class="skeleton-icon"></div>
                    <div style="flex-grow: 1;">
                        <div class="skeleton-line" style="width: 40%; height: 24px;"></div>
                        <div class="skeleton-line" style="width: 80%; margin-top: 10px;"></div>
                    </div>
                </div>
                <div class="skeleton-line" style="height: 40px; width: 100%; margin-bottom: 1rem;"></div>
                <div class="skeleton-line" style="height: 40px; width: 100%; margin-bottom: 1rem;"></div>
                <div class="skeleton-line" style="height: 40px; width: 100%; margin-bottom: 1rem;"></div>
                <div class="skeleton-row" style="height: 300px;"></div>
            </div>
        </div>

        {# COLONNE 4 : COLONNE DE VISUALISATION #}
        <div class="menu-col-4" data-workspace-manager-target="visualizationColumn">
            <div class="tab-panel-container">
                {# La barre où les titres des onglets apparaîtront #}
                <div class="tab-header" data-workspace-manager-target="tabContainer">
                    </div>
                {# La zone où le contenu de l'onglet actif s'affichera #}
                <div class="tab-content-container" data-workspace-manager-target="tabContentContainer">
                    </div>
            </div>
        </div>
    </div>

    {# Template caché pour générer la liste des rubriques (utilisé par Stimulus) #}
    <template data-workspace-manager-target="rubriquesTemplate">
        <div class="rubriques-list">
            {% for group_name, group_data in menu.colonne_1.groupes %}
                <div id="rubriques-{{ group_name|replace({' ': '_'}) }}">
                    {% for rubrique_name, rubrique_data in group_data.rubriques %}
                        <div class="rubrique-item"
                            data-action="click->workspace-manager#loadComponent"
                            data-workspace-manager-component-name-param="{{ rubrique_data.composant_twig }}" 
                            data-workspace-manager-group-name-param="{{ group_name }}" 
                            data-workspace-manager-entity-name-param="{{ rubrique_data.entity_name|default('') }}"
                            data-workspace-manager-description-param=""
                        >
                            <twig:UX:Icon name="{{ resolve_icon_name(rubrique_data.icone) }}" class="rubrique-icon" />
                            <span class="rubrique-text">{{ rubrique_name }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </template>

    {# Template pour un seul onglet (le titre cliquable) #}
    <template data-workspace-manager-target="tabTemplate">
        <div class="tab-item" data-action="click->workspace-manager#activateTab">
            <span class="tab-item-icon"></span>
            <span class="tab-item-title" data-role="tab-title"></span>
            <button class="tab-item-close" data-action="click->workspace-manager#closeTab">
                <twig:UX:Icon name="{{ resolve_icon_name('action:close') }}" />
            </button>
        </div>
    </template>

    {# Template pour le contenu d'un onglet (l'accordéon) #}
    <template data-workspace-manager-target="tabContentTemplate">
        <div class="tab-content">
            <div class="accordion-search-bar" data-action="click->workspace-manager#focusSearch">
                <twig:UX:Icon name="{{ resolve_icon_name('action:search') }}" class="search-icon" />
                <input type="text" 
                    class="accordion-search-input"
                    placeholder="Filtrer Ici"
                    data-action="input->workspace-manager#filter"
                    data-workspace-manager-target="searchInput"
                >
                <button type="button" class="icon-button" data-action="click->workspace-manager#resetFilter" title="Réinitialiser">
                    <twig:UX:Icon name="{{ resolve_icon_name('action:reset') }}" />
                </button>
                <span class="separator"></span>
                <button type="button" class="icon-button" data-action="click->workspace-manager#closeTab" title="Fermer l'onglet">
                    <twig:UX:Icon name="{{ resolve_icon_name('action:exit') }}" />
                </button>
            </div>
            <div class="accordion"> {# Le contrôleur workspace-manager gère déjà cet élément #}
                {# L'accordéon avec les détails de l'entité sera généré ici par Stimulus #}
            </div>
            <div class="no-results-message" data-workspace-manager-target="noResultsMessage" style="display: none;">
                Aucun attribut ne correspond à votre recherche.
            </div>
        </div>
    </template>
</div>