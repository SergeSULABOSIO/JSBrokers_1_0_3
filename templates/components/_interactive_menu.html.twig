{% set menu = menu_data %}
<div 
    {{ stimulus_controller('espace-de-travail') }} 
    {# data-espace-de-travail-entity-canvas-value="{{ entityCanvas|json_encode }}" #}
>
    {# Barre de progression globale, contrôlée par Stimulus #}
    <div data-espace-de-travail-target="progressBar" class="progress-bar"></div>
    <div class="interactive-menu">
        {# COLONNE 1 : Navigation principale #}
        <div class="menu-col-1">
            {# Ligne 1: Tableau de bord #}
            <div class="menu-col-1-row-1">
                <div class="nav-item"
                    data-action="click->espace-de-travail#loadComponent"
                    data-espace-de-travail-component-name-param="{{ menu.colonne_1.tableau_de_bord.composant_twig }}"
                    data-espace-de-travail-description-param="{{ menu.colonne_1.tableau_de_bord.description }}"
                    data-espace-de-travail-target="dashboardItem"  {# AJOUTEZ CETTE LIGNE #}
                >
                    <twig:ux:icon name="{{ menu.colonne_1.tableau_de_bord.icone }}" class="nav-icon"/>
                    <span class="nav-text">{{ menu.colonne_1.tableau_de_bord.nom }}</span>
                </div>
            </div>

            {# Ligne 2: Groupes #}
            <div class="menu-col-1-row-2">
                {% for group_name, group_data in menu.colonne_1.groupes %}
                    <div class="nav-item"
                        data-action="mouseenter->espace-de-travail#showGroupDescription mouseleave->espace-de-travail#clearDescription click->espace-de-travail#showGroupRubriques"
                        data-espace-de-travail-group-name-param="{{ group_name }}"
                        data-espace-de-travail-description-param="{{ group_data.description }}"
                    >
                        <twig:ux:icon name="{{ group_data.icone }}" class="nav-icon"/>
                        <span class="nav-text">{{ group_name }}</span>
                    </div>
                {% endfor %}
            </div>

            {# Ligne 3: Paramètres #}
            <div class="menu-col-1-row-3">
                {% for param_name, param_data in menu.colonne_1.parametres %}
                    <div class="nav-item"
                        data-action="click->espace-de-travail#loadComponent"
                        data-espace-de-travail-component-name-param="{{ param_data.composant_twig }}"
                        data-espace-de-travail-description-param="{{ param_data.description }}"
                    >
                        <twig:ux:icon name="{{ param_data.icone }}" class="nav-icon"/>
                        <span class="nav-text">{{ param_name }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>

        {# COLONNE 2 : Rubriques & Descriptions #}
        <div class="menu-col-2">
            {# Ligne 1: Infos Entreprise #}
            <div class="menu-col-2-row-1">
                <img src="{{ asset(menu.colonne_2.logo) }}" alt="Logo" class="company-logo">
                <h2 class="company-title">{{ menu.colonne_2.titre }}</h2>
                <p class="company-description">{{ menu.colonne_2.description }}</p>
                <span class="company-version">Version {{ menu.colonne_2.version }}</span>
            </div>
            {# Ligne 2: Zone dynamique pour descriptions et rubriques #}
            <div class="menu-col-2-row-2" data-espace-de-travail-target="contentZone">
                {# Contenu injecté par Stimulus #}
            </div>
        </div>

        {# COLONNE 3 : Espace de travail #}
        <div class="menu-col-3" data-espace-de-travail-target="workspace">
            {# Le composant Twig chargé apparaîtra ici #}
            <div class="workspace-placeholder">
                <p>Sélectionnez un élément dans le menu pour commencer.</p>
            </div>
        </div>

        {# COLONNE 4 : COLONNE DE VISUALISATION #}
        <div class="menu-col-4" data-espace-de-travail-target="visualizationColumn">
            <div class="tab-panel-container">
                {# La barre où les titres des onglets apparaîtront #}
                <div class="tab-header" data-espace-de-travail-target="tabContainer">
                    </div>
                {# La zone où le contenu de l'onglet actif s'affichera #}
                <div class="tab-content-container" data-espace-de-travail-target="tabContentContainer">
                    </div>
            </div>
        </div>
    </div>

    {# Template caché pour générer la liste des rubriques (utilisé par Stimulus) #}
    <template data-espace-de-travail-target="rubriquesTemplate">
        <div class="rubriques-list">
            {% for group_name, group_data in menu.colonne_1.groupes %}
                <div id="rubriques-{{ group_name|replace({' ': '_'}) }}">
                    {% for rubrique_name, rubrique_data in group_data.rubriques %}
                        <div class="rubrique-item"
                            data-action="click->espace-de-travail#loadComponent"
                            data-espace-de-travail-component-name-param="{{ rubrique_data.composant_twig }}"
                            data-espace-de-travail-description-param="" {# Les rubriques n'ont pas de description à afficher #}
                        >
                            <twig:ux:icon name="{{ rubrique_data.icone }}" class="rubrique-icon" />
                            <span class="rubrique-text">{{ rubrique_name }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </template>

    {# [MODIFICATION 3] AJOUT DES TEMPLATES POUR LES ONGLETS ET LEUR CONTENU #}

    {# Template pour un seul onglet (le titre cliquable) #}
    <template data-espace-de-travail-target="tabTemplate">
        <div class="tab-item" data-action="click->espace-de-travail#activateTab">
            {# MODIFICATION : Le contenu de l'icône est vide. JS s'en occupera. #}
            <span class="tab-item-icon">{{ ux_icon('mage:file-2') }}</span>
            <span class="tab-item-title" data-role="tab-title"></span> {# L'ID de l'objet ira ici [cite: 52] #}
            {# <button class="tab-item-close" data-action="click->espace-de-travail#closeTab">X</button> #}
            {# MODIFICATION : Le "X" est remplacé par une icône #}
            <button class="tab-item-close" data-action="click->espace-de-travail#closeTab">
                {{ ux_icon('heroicons:x-mark') }}
            </button>
        </div>
    </template>

    {# Template pour le contenu d'un onglet (l'accordéon) #}
    <template data-espace-de-travail-target="tabContentTemplate">
        <div class="tab-content">
            <div class="accordion-search-bar" data-action="click->espace-de-travail#focusSearch">
                {{ ux_icon('heroicons:magnifying-glass-solid', { class: 'search-icon' }) }}
                <input type="text" 
                    class="accordion-search-input"
                    placeholder="Filtrer Ici"
                    data-action="input->espace-de-travail#filterAccordion"
                    data-espace-de-travail-target="accordionSearchInput"
                >
                <button type="button" class="icon-button" data-action="click->espace-de-travail#resetFilter" title="Réinitialiser">
                    {{ ux_icon('heroicons:x-mark') }}
                </button>
                <span class="separator"></span>
                <button type="button" class="icon-button" data-action="click->espace-de-travail#closeTab" title="Fermer l'onglet">
                    {{ ux_icon('lucide:log-out') }}
                </button>
            </div>
            <div class="accordion" data-controller="accordion">
                {# L'accordéon avec les détails de l'entité sera généré ici par Stimulus #}
            </div>
            <div class="no-results-message" style="display: none;">
                Aucun attribut ne correspond à votre recherche.
            </div>
        </div>
    </template>
</div>