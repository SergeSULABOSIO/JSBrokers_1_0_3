<div 
    data-controller = "rubrique" 
    data-rubrique-nom-value = "Notification Sinistre"
    class="d-flex flex-column h-100"
>
    <div 
        id = "liste" 
        class="flex-grow-1 d-flex flex-column" 
        data-controller="dialogue liste-principale" 
        data-liste-principale-identreprise-value={{entreprise.id}} 
        data-liste-principale-idutilisateur-value={{utilisateur.id}} 
        data-liste-principale-nbelements-value={{notificationsinistres|length}} 
        data-liste-principale-rubrique-value="Notification Sinistre" 
        data-liste-principale-entite-value="NotificationSinistre" 
        data-liste-principale-controleurphp-value="notificationsinistre" 
        data-liste-principale-controleurstimulus-value="notificationsinistre-formulaire" 
        {# data-liste-principale-controleurstimulusformulaire-value="notificationsinistre-formulaire"  #}
    >
        {# Ce conteneur va aussi utiliser flexbox et cacher tout débordement #}
        <div class="shadow-sm sensible bg-white d-flex flex-column flex-grow-1" style="overflow: hidden;">
            {# Les barres d'outils ne grandissent pas #}
            <div class="flex-shrink-0">
                {# Barre d'outils #} 
                {{ include("components/_liste_barre_outils.html.twig") }}
                {# Barre de Recherche #}
                {{ component('_search_bar') }}
                {# Barre des totaux #}
                {{ include('components/_totals_bar.html.twig') }}
            </div>

            {# NOUVEAU : Un wrapper pour le tableau qui gère le défilement #}
            <div class="table-scroll-wrapper flex-grow-1">
                {# Tableau #}
                <table class="table table-hover table-sm caption-top p-3 table-enhanced">
                    <caption>
                        <span data-liste-principale-target = "display">
                            {% if notificationsinistres|length == 0 %}
                                {{ "list_filter_result_empty" | trans}}
                            {% else %}
                                {{ "list_filter_result_elements" | trans({
                                    ':number': notificationsinistres|length
                                })}}
                            {% endif %}
                        </span>
                        <div class="d-flex gap-1">
                            {{ knp_pagination_render(notificationsinistres) }}
                        </div>
                    </caption>
                    {% if notificationsinistres|length != 0 %}
                        {# MODIFICATION : On ajoute une classe pour rendre l'en-tête collant #}
                        <thead class="table-light sticky-header">
                            <tr class="text-center">
                                {# Titre pour case à cocher #}
                                <th scope="col">
                                    <div class="form-check m-2 justify-content-start">
                                        <input 
                                            class="form-check-input" 
                                            value="" 
                                            type="checkbox" 
                                            id="myCheckbox" 
                                            data-action="change->liste-principale#handleItemToutCocher" 
                                            data-liste-principale-target="selectAllCheckbox"
                                        >
                                        <label 
                                            for="myCheckbox"
                                            class="text-secondary" 
                                        >
                                            Id.  
                                        </label>
                                    </div>
                                </th>
                                {# Titre Colonne Principale #}
                                <th scope="col">
                                    <div class='d-flex justify-content-start text-secondary m-2'>
                                        Titre Colonne principale
                                    </div>
                                </th>
                                {# Titres pour Colonnes numériques : #}
                                {# Titre colonne numérique 1 #}
                                <th scope="col" style="width:100px" >
                                    <div class='d-flex justify-content-end'>
                                        Dommage
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        {# CONTENU DU TABLEAU #}
                        <tbody class="table-group-divider context-target" data-liste-principale-target = "donnees">
                            <div 
                                data-controller="donnees"
                                {# J'envoie l'objet status vers le controleur stimulus: comme c'est un objet, il faut le décorer avec |json_encode #}
                                data-donnees-status-value='{{ status|json_encode }}' 
                                data-donnees-page-value={{ page }}
                                data-donnees-limit-value={{ limit }}
                                data-donnees-totalitems-value={{ totalItems }}
                            ></div>
                            {% if notificationsinistres|length == 0 %}
                                <tr>
                                    <td class="p-3 m-2" style="width:80px"></td>
                                    <td class="p-2">Aucune information trouvée!</td>
                                    <td></td>
                                </tr>
                            {% else %}
                                {# Boucler les donnees #}
                                {% for notificationsinistre in notificationsinistres %}
                                    {# LIGNE DU TABLEAU #}
                                    <tr 
                                        id="liste_row_{{ notificationsinistre.id }}" 
                                        data-controller="liste-element" 
                                        data-liste-element-isShown-value = false 
                                        data-liste-element-idobjet-value = {{notificationsinistre.id}} 
                                        class="element-a-encadrer parent-a-options context-target align-middle" 
                                        
                                        {# Boucle pour générer dynamiquement les data-attributes numériques #}
                                        {% for key, value in constante.getNumericValues(notificationsinistre) %}
                                            data-{{ key }}-value="{{ value }}"
                                        {% endfor %}
                                        data-action="click->liste-principale#toggleRowSelection"
                                    >
                                        {# COLONNE 1 DU TABLEAU #}
                                        <td class="p-3 m-2" style="width:80px">
                                            {# ... votre checkbox ... #}
                                            <div class="form-group">
                                                <input 
                                                    type="checkbox" 
                                                    id="check_{{ notificationsinistre.id }}" 
                                                    name="check_[]" 
                                                    value="selectionnee" 
                                                    class="form-check-input" 
                                                    data-action="change->liste-principale#handleCheckboxChange" 
                                                    data-liste-principale-target="rowCheckbox"
                                                    data-idobjet-value="{{ notificationsinistre.id }}"  
                                                >
                                                <label 
                                                    for="check_{{ notificationsinistre.id }}" 
                                                    class="text-secondary" 
                                                >
                                                    {{ notificationsinistre.id }}
                                                </label>
                                            </div>
                                        </td>

                                        {# COLONNE 2 DU TABLEAU #}
                                        <td class="p-2">
                                            {# texte principal #}
                                            <span class="text-secondary">
                                                {{ include('segments/icones/notificationsinistre.html.twig', {size:'19px'}) }}
                                                "{{ notificationsinistre.descriptionDeFait|slice(0, 75) }} [...]"
                                            </span><br/>
                                            {# texte secondaire #}
                                            <small  class="m-2">
                                                <span class="text-secondary">
                                                    {{ include('segments/icones/client.html.twig', {size:'16px'}) }}
                                                    {{ notificationsinistre.assure.nom }}
                                                </span>
                                            </small>
                                        </td>
                                        {# COLONNE 3 DU TABLEAU #}
                                        <td>
                                            0.000,00 USD
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        </tbody>
                    {% endif %}
                </table>
            </div>
        </div>
        {{ include('components/_menu_contextuel.html.twig') }}
        {{ include('components/_dialogue.html.twig') }}
    </div>
</div>