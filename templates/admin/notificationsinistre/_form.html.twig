{{ form_start(form) }}
    {% if entityFormCanvas.parametres.form_layout is defined and entityFormCanvas.parametres.form_layout is not empty %}
        {% for row in entityFormCanvas.parametres.form_layout %}
            {% set row_style = (row.couleur_fond is defined and row.couleur_fond) ? 'background-color: ' ~ row.couleur_fond ~ ';' : '' %}
            {% set row_class = (row.couleur_fond is defined and row.couleur_fond) ? 'form-row-colored' : '' %}
            <div class="row gx-3 {{ row_class }}" style="{{ row_style }}">
                {% set col_class = 'col-md-' ~ (12 / row.colonnes|length)|round(0, 'floor') %}
                {% for col in row.colonnes %}
                    <div class="{{ col_class }}">
                        {% for field_code in col.champs %}
                            {% if form[field_code] is defined %}

                                {# --- DÉBUT DE LA MODIFICATION --- #}
                                <div class="mb-3">
                                    {# 1. On affiche le label (le CSS le mettra en italique) #}
                                    {{ form_label(form[field_code]) }}
                                    
                                    {# 2. On crée le conteneur pour l'icône et le champ #}
                                    <div class="form-input-with-icon">
                                        {# On affiche l'icône "stylo" choisie #}
                                        {{ ux_icon('mage:edit-pen', { class: 'input-icon' }) }}
                                        
                                        {# On affiche le champ lui-même (input, select, etc.) #}
                                        {{ form_widget(form[field_code]) }}
                                    </div>
                                    
                                    {# 3. On affiche les erreurs de validation #}
                                    <div class="form-text text-danger">{{ form_errors(form[field_code]) }}</div>
                                </div>
                                {# --- FIN DE LA MODIFICATION --- #}

                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% else %}
        {{ form_widget(form) }}
    {% endif %}
    {{ form_rest(form) }}
{{ form_end(form) }}